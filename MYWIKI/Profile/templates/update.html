{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <title>ë‚˜ì˜ìœ„í‚¤</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>

  <script type="text/javascript">
    $(document).ready(function () {
      // â• ë²„íŠ¼ í´ë¦­ì‹œ
      $("#addItemBtn").click(function () {
        // item ì˜ ìµœëŒ€ë²ˆí˜¸ êµ¬í•˜ê¸°
        var lastItemNo = $("#profile_tb tr:last")
          .attr("class")
          .replace("item", "");

        var newitem = $("#profile_tb tr:eq(1)").clone();
        newitem.removeClass();
        newitem.find("td:eq(0)").attr("rowspan", "1");
        newitem.addClass("item" + (parseInt(lastItemNo) + 1));

        $("#profile_tb").append(newitem);
      });

      // ì‚­ì œë²„íŠ¼ í´ë¦­ì‹œ
      $(".delBtn").live("click", function () {
        var clickedRow = $(this).parent().parent();
        var cls = clickedRow.attr("class");

        // ê° í•­ëª©ì˜ ì²«ë²ˆì§¸ rowë¥¼ ì‚­ì œí•œ ê²½ìš° ë‹¤ìŒ rowì— td í•˜ë‚˜ë¥¼ ì¶”ê°€í•´ ì¤€ë‹¤.
        if (clickedRow.find("td:eq(0)").attr("rowspan")) {
          if (clickedRow.next().hasClass(cls)) {
            clickedRow
              .next()
              .prepend(clickedRow.find("td:eq(0)"));
          }
        }

        clickedRow.remove();

        // rowspan ì¡°ì •
        resizeRowspan(cls);
      });
      // cls : rowspan ì„ ì¡°ì •í•  class ex) item1, item2, ...
      function resizeRowspan(cls) {
        var rowspan = $("." + cls).length;
        $("." + cls + ":first td:eq(0)").attr("rowspan", rowspan);
      }
    });
  </script>
  <link rel="stylesheet" href="{% static 'css/base.css' %}" />
  <link rel="stylesheet" href="{% static 'css/photo.css' %}" />
  <link rel="stylesheet" href="{% static 'css/update.css' %}" />
</head>
<style>
  #first {
    margin: 0 auto;
    width: 300px;
    margin-top: 200px;

  }

  #first>table {
    height: 400px;
    width: 300px;
  }

  #form {
    margin-bottom: 200px;
  }
</style>

<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="navbar">
    <div>
      <a class="navbar_logo" href="{% url 'home' %}"><img src="{% static 'img/logo.png' %}"></a>
    </div>
    {% if user.is_authenticated %}
    <a href="{% url 'read' profile.id %}" class="navitem">ë‚´ í”„ë¡œí•„</a>
    <a href="" class="navitem">ê¸°ë¡ ë³´ê¸°</a>
    {% endif %}
    {% if user.is_authenticated %}
    <a href="{% url 'logout' %}">ë¡œê·¸ ì•„ì›ƒ</a>
    {% endif %}
    {% if not user.is_authenticated %}
    <a href="{% url 'login'%}">ë¡œê·¸ì¸</a>
    {% endif %}
  </nav>

  <script>
    const currentLocation = location.href;
    const navItem = document.querySelectorAll('.navitem');
    const navLength = navItem.length;
    for (let i = 0; i < navLength; i++) {
      if (navItem[i].href === currentLocation) {
        navItem[i].className = "navitem active"
      }
    }
  </script>



  <!-- ì‚¬ì§„ ì—…ë¡œë“œ -->

  <ul class="profile_list"></ul>
  </section>


  <div id="first">


    <form id="form" onsubmit="" method="POST" action="{% url 'update' profile.id %}">
      <!--í”ŒëŸ¬ìŠ¤ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ row í–‰ ì¶”ê°€ ë˜ì•¼-->
      {%csrf_token%}
      <tr>
        <th>subject</th>
        <th>content</th>
      </tr>
      <tr class="item1">
        <td>ì´ë¦„ ì…ë ¥ğŸ’­</td>
        <td><input type="text" name="name" value="{{profile.name}}" /></td>
      </tr>
      <tr class="item2">
        <td>ìƒì¼ ì…ë ¥ğŸ‚</td>
        <td><input type="text" name="bdate" value="{{profile.bdate}}" />
        </td>
      </tr>
      <tr class="item3">
        <td>ì¶œìƒì§€ğŸŒ
        </td>
        <td><input type="text" name="bplace" value="{{profile.bplace}}" /></td>
      </tr>
      <tr class="item4">
        <td>ì†Œì†ğŸ›
        </td>
        <td>
          <input type="text" name="organ" value="{{profile.organ}}" />
        </td>
      </tr>
      <tr class="item5">
        <td>mbtiâ™¥ï¸
        </td>
        <td><input type="text" name="mbti" value="{{profile.mbti}}" /></td>
      </tr>
      <tr class="item6">
        <td>ê°€ì¹˜ê´€ğŸ’­
        </td>
        <td><input type="text" name="message" value="{{profile.message}}" /></td>
      </tr>
      <tr class="item7">
        <td>SNSğŸ“±
        </td>
        <td>
          <input type="text" name="sns" value="{{profile.sns}}" />
        </td>
      </tr>
      </table>
      ë°©ëª…ë¡
      <input type="text" name="topic_content" value="{{profile.topic_content}}" /></td>

      <input type="submit" value="ì €ì¥">
    </form>


  </div>

  <script>
    function submitForm() {
      const form = document.getElementById("form");
      form.submit();
    }
    let btns = document.querySelectorAll("button");
    for (i in btns) {
      btns[i].setAttribute("type", "button");
      console.log(btns[i]);
    }
  </script>
  <script>
    //ì½”ë©˜íŠ¸ ì‘ì„±

    function warnEmpty() {
      alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }

    function dateToString(date) {
      const dateString = date.toISOString();
      const dateToString = dateString.substring(0, 10);
      return dateToString;
    }

    function submitReview() {
      const newreviewEL = document.getElementById("new-review");
      const newreview = newreviewEL.value.trim();

      if (newreview) {
        const starEL = document.createElement('div');
        const starString = starReview(document.getElementById);
        starEL.innerText = starString;

        const dateEL = document.createElement('div');
        dateEL.classList.add('review-date');
        const dateString = dateToString(new Date());
        dateEL.innerText = dateString;

        const contentEL = document.createElement('div');
        contentEL.classList.add('review-content');
        contentEL.innerText = newreview;

        const br = document.createElement('div');
        br.innerHTML = "<hr><br><br>"

        const name = document.createElement('div');
        name.innerHTML = "ìµëª… &emsp;"

        const reviewEL = document.createElement('div');
        reviewEL.classList.add('review-row');
        reviewEL.appendChild(br);
        reviewEL.appendChild(name);
        reviewEL.appendChild(starEL);
        reviewEL.appendChild(dateEL);
        reviewEL.appendChild(contentEL);

        document.getElementById('review').appendChild(reviewEL);
        newreviewEL.value = "";

        const countEL = document.getElementById('review-count');
        const count = countEL.innerText;
        countEL.innerText = parseInt(count) + 1;
      } else {
        warnEmpty();
      }
    }
  </script>
</body>
<script>
  //ì‚¬ì§„ ì²¨ë¶€ js
  var submit = document.getElementById("submitButton");
  submit.onclick = showImage; //Submit ë²„íŠ¼ í´ë¦­ì‹œ ì´ë¯¸ì§€ ë³´ì—¬ì£¼ê¸°

  function showImage() {
    var newImage =
      document.getElementById("image-show").lastElementChild;
    newImage.style.visibility = "visible";

    document.getElementById("image-upload").style.visibility =
      "hidden";

    document.getElementById("fileName").textContent = null; //ê¸°ì¡´ íŒŒì¼ ì´ë¦„ ì§€ìš°ê¸°
  }
  function loadFile(input) {
    var file = input.files[0];

    var name = document.getElementById("fileName");
    name.textContent = file.name;

    var newImage = document.createElement("img");
    newImage.setAttribute("class", "img");

    newImage.src = URL.createObjectURL(file);

    newImage.style.width = "70%";
    newImage.style.height = "70%";
    newImage.style.visibility = "hidden"; //ë²„íŠ¼ì„ ëˆ„ë¥´ê¸° ì „ê¹Œì§€ëŠ” ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸°
    newImage.style.objectFit = "contain";

    var container = document.getElementById("image-show");
    container.appendChild(newImage);
  }
</script>

</html>